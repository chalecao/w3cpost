---
title: 高性能极致用户体验开发实战

---

  <img loading="lazy" class="alignnone wp-image-2916 shadow" src="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfbee2b8f33f.png" data-src="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfbee2b8f33f.png?x-oss-process=image/format,webp" alt="" width="441" height="306" srcset="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfbee2b8f33f.png?x-oss-process=image/format,webp 1375w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfbee2b8f33f.png?x-oss-process=image/quality,q_50/resize,m_fill,w_300,h_208/format,webp 300w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfbee2b8f33f.png?x-oss-process=image/quality,q_50/resize,m_fill,w_768,h_532/format,webp 768w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfbee2b8f33f.png?x-oss-process=image/quality,q_50/resize,m_fill,w_800,h_554/format,webp 800w" sizes="(max-width: 441px) 100vw, 441px" />

# 课程介绍

高性能极致用户体验[前端](https://www.w3cdoc.com)开发实战课程适合所有[前端](https://www.w3cdoc.com)开发学习或者从业者，结合目前[前端](https://www.w3cdoc.com)开发的最佳实践，提供[前端](https://www.w3cdoc.com)网页性能分析优化知识，结合实际项目经验分析可以采用的优化思路，并给出开发高性能极致体验网页的通用方法和技巧。

<span style="color: #ff0000;">在线课程</span>：[高性能极致用户体验[前端](https://www.w3cdoc.com)开发实战][1]

思否课程：[高性能极致用户体验[前端](https://www.w3cdoc.com)开发实战][2]

课时1：[[前端](https://www.w3cdoc.com)性能优化标准与指标][3]

课时2：[[前端](https://www.w3cdoc.com)页面性能指标数据计算方法][4]

课时3：[[前端](https://www.w3cdoc.com)页面性能指标数据采集架构][5]

课时4：[[前端](https://www.w3cdoc.com)网页加载渲染链路优化][6]

课时5：[[前端](https://www.w3cdoc.com)极致性能体验编码框架优化][7]

在开始学习本课程之前，先提2个基本要求：

## 了解业务

作为一名合格的[前端](https://www.w3cdoc.com)开发，[我们](https://www.w3cdoc.com)的开发工作不是盲目的，[我们](https://www.w3cdoc.com)的优化目标需要明确，所以首先要了解你所做的业务。不仅要知道整个业务背景，还需要了解业务需求，业务目的，最后最好能拿到业务结果。


  <img loading="lazy" class="alignnone wp-image-2877 shadow" src="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa9be658f51.png" data-src="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa9be658f51.png?x-oss-process=image/format,webp" alt="" width="544" height="218" srcset="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa9be658f51.png?x-oss-process=image/format,webp 1232w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa9be658f51.png?x-oss-process=image/quality,q_50/resize,m_fill,w_300,h_120/format,webp 300w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa9be658f51.png?x-oss-process=image/quality,q_50/resize,m_fill,w_768,h_308/format,webp 768w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa9be658f51.png?x-oss-process=image/quality,q_50/resize,m_fill,w_800,h_321/format,webp 800w" sizes="(max-width: 544px) 100vw, 544px" />

了解业务的目的是能让你更好的分配开发的权重，合理安排开发的重点。比如开发的是视频类网站，那么开发的重点自然在于播放器加载和流畅播放以及降级方案。如果是天气类业务，那么核心业务是要保障稳定快速的展示出天气相关数据，然后是加载展示其他内容。如果是博文类网站，那么重点在于首屏的信息加载和展示。

## 了解用户


  <img loading="lazy" class="alignnone wp-image-2874 shadow" src="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa99b920305.png" data-src="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa99b920305.png?x-oss-process=image/format,webp" alt="" width="406" height="238" srcset="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa99b920305.png?x-oss-process=image/format,webp 1222w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa99b920305.png?x-oss-process=image/quality,q_50/resize,m_fill,w_300,h_176/format,webp 300w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa99b920305.png?x-oss-process=image/quality,q_50/resize,m_fill,w_768,h_450/format,webp 768w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa99b920305.png?x-oss-process=image/quality,q_50/resize,m_fill,w_800,h_469/format,webp 800w" sizes="(max-width: 406px) 100vw, 406px" />

了解用户也是至关重要，如果连自己所做业务的受众都不知道，那么何谈用户体验，何谈极致性能？ 这一部分至少你要知道现在做的业务主要是面向PC用户还是移动web用户，PC用户所用的[浏览器](https://www.w3cdoc.com)都是什么版本，比例分布是怎样？移动端用户android和ios比例多少，各自平台版本分布情况如何？这是最基本的要求，因为[我们](https://www.w3cdoc.com)开发的代码是在这些平台运行的。 如果不知道怎么办？没关系，从今天开始统计起来，做个埋点日志服务，[前端](https://www.w3cdoc.com)写个脚本上报下useragent就可以了。

<pre class="EnlighterJSRAW" data-enlighter-language="js">navigator.userAgent
"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36"</pre>

# 课程大纲

* 评判标准
  * RAIL评估模型
  * 性能指标
  * 体验指标
  * 指标数据采集
* 优化实战
  * 链路优化
  * 编程优化
* 链路优化
  * 链路阶段分析
  * 阶段指标数据
  * 各阶段优化手段
  * 案例分析和常用工具
* 编程优化
  * 首屏渲染
  * 懒加载功能组件
  * 滚动加载分页组件
  * web worker计算
  * Task切分
  * 代码分割与打包
  * [前端](https://www.w3cdoc.com)开发架构优化

* [前端](https://www.w3cdoc.com)开发架构优化
  * ES6 module+template
  * web component
  * 轻react或vue
  * 微[前端](https://www.w3cdoc.com)架构

# 评判标准

无规矩不成方圆，所以这里先说说评判标准。评判标准主要指的是用户打开网页、浏览网页的体验和感受。[我们](https://www.w3cdoc.com)需要一种客观的评估模型来统一量化用户体验的各个环节，这样才能找到需要优化的方向，找到开发极致用户体验网页的捷径。

## RAIL评估模型

[RAIL][8] 是一种以用户为中心的性能模型。每个网络应用均具有与其生命周期有关的四个不同方面，且这些方面以不同的方式影响着性能。以用户为中心；最终目标不仅是让您的网站在任何特定设备上都能运行很快，而是使用户满意。


  <img loading="lazy" class="alignnone wp-image-2868 shadow" src="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7d9c7b407.png" data-src="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7d9c7b407.png?x-oss-process=image/format,webp" alt="" width="389" height="141" srcset="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7d9c7b407.png?x-oss-process=image/format,webp 1390w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7d9c7b407.png?x-oss-process=image/quality,q_50/resize,m_fill,w_300,h_109/format,webp 300w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7d9c7b407.png?x-oss-process=image/quality,q_50/resize,m_fill,w_768,h_278/format,webp 768w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7d9c7b407.png?x-oss-process=image/quality,q_50/resize,m_fill,w_800,h_290/format,webp 800w" sizes="(max-width: 389px) 100vw, 389px" />

* Response，立即响应用户；在 100 毫秒以内确认用户输入，超过100ms建议加上动效或者loading，通过视觉冲击减少用户等待的焦虑。
* Animation，设置动画或滚动时，在 10 毫秒以内生成帧。
* Idle，最大程度增加主线程的空闲时间。主线程空闲才能随时都可以及时响应。
* Load，持续吸引用户；在 1000 毫秒以内呈现交互内容。

让用户成为您的性能工作的中心。用户花在网站上的大多数时间不是等待加载，而是在使用时等待响应。了解用户如何评价性能延迟：

<div class="devsite-table-wrapper">
  <table class="responsive" style="height: 432px;" width="906">
    <tr>
      <th colspan="2">
        延迟与用户反应
      </th>
    </tr>

    <tr>
      <td data-th="Delay">
        0 &#8211; 16 毫秒
      </td>
      
      <td data-th="User Reaction">
        流畅；人们特别擅长跟踪运动，如果动画不流畅，他们就会对运动心生反感。 用户可以感知每秒渲染 60 帧的平滑动画转场。也就是每帧 16 毫秒（包括[浏览器](https://www.w3cdoc.com)将新帧绘制到屏幕上所需的时间），留给应用大约 10 毫秒的时间来生成一帧。
      </td>
    </tr>
    
    <tr>
      <td data-th="Delay">
        0 &#8211; 100 毫秒
      </td>
      
      <td data-th="User Reaction">
        快，在此时间窗口内响应用户操作，他们会觉得可以立即获得结果。时间再长，操作与反应之间的连接就会中断。
      </td>
    </tr>
    
    <tr>
      <td data-th="Delay">
        100 &#8211; 300 毫秒
      </td>
      
      <td data-th="User Reaction">
        可感觉慢，需要loading，用户会遇到轻微可觉察的延迟。
      </td>
    </tr>
    
    <tr>
      <td data-th="Delay">
        300 &#8211; 1000 毫秒
      </td>
      
      <td data-th="User Reaction">
        慢，需要做loading和占位。在此窗口内，延迟感觉像是任务自然和持续发展的一部分。对于网络上的大多数用户，加载页面或更改视图代表着一个任务。
      </td>
    </tr>
    
    <tr>
      <td data-th="Delay">
        1000+ 毫秒
      </td>
      
      <td data-th="User Reaction">
        很慢，超过 1 秒，用户的注意力将离开他们正在执行的任务。
      </td>
    </tr>
    
    <tr>
      <td data-th="Delay">
        10,000+ 毫秒
      </td>
      
      <td data-th="User Reaction">
        放弃，用户感到失望，可能会放弃任务；之后他们或许不会再回来。
      </td>
    </tr>
  </table>
</div>

### 响应：在 100 毫秒以内响应 {#100}

在用户注意到滞后之前您有 100 毫秒的时间可以响应用户输入。这适用于大多数输入，不管他们是在点击按钮、切换表单控件还是启动动画。但不适用于触摸拖动或滚动。 如果您未响应，操作与反应之间的连接就会中断。用户会注意到。 尽管很明显应立即响应用户的操作，但这并不总是正确的做法。使用此 100 毫秒窗口执行其他开销大的工作，但需要谨慎，以免妨碍用户。如果可能，请在后台执行工作。 对于需要超过 500 毫秒才能完成的操作，请始终提供反馈机制，比如loading，进度条等。

### 动画：在 10 毫秒内生成一帧 {#10}

动画不只是奇特的 UI 效果。例如，滚动和触摸拖动就是动画类型。 如果动画帧率发生变化，您的用户确实会注意到。您的目标就是每秒生成 60 帧，每一帧必须完成以下所有步骤：


  <img loading="lazy" class="alignnone wp-image-2869 shadow" src="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7dbdae8cc.png" data-src="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7dbdae8cc.png?x-oss-process=image/format,webp" alt="" width="469" height="63" srcset="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7dbdae8cc.png?x-oss-process=image/format,webp 1330w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7dbdae8cc.png?x-oss-process=image/quality,q_50/resize,m_fill,w_300,h_40/format,webp 300w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7dbdae8cc.png?x-oss-process=image/quality,q_50/resize,m_fill,w_768,h_103/format,webp 768w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7dbdae8cc.png?x-oss-process=image/quality,q_50/resize,m_fill,w_800,h_107/format,webp 800w" sizes="(max-width: 469px) 100vw, 469px" />

从纯粹的数学角度而言，每帧的预算约为 16 毫秒（1000 毫秒 / 60 帧 = 16.66 毫秒/帧）。 但因为[浏览器](https://www.w3cdoc.com)需要花费时间将新帧绘制到屏幕上，只有 10 毫秒来执行代码。 在像动画一样的高压点中，关键是不论能不能做，什么都不要做，做最少的工作。 如果可能，请利用 100 毫秒响应预先计算开销大的工作，这样您就可以尽可能增加实现 60fps 的可能性。 如需了解详细信息，请参阅[渲染性能][9]。

### 空闲：最大程度增加空闲时间 {#_2}

利用空闲时间完成推迟的工作。例如，尽可能减少预加载数据，以便您的应用快速加载，并利用空闲时间加载剩余数据。 推迟的工作应分成每个耗时约 50 毫秒的多个块。如果用户开始交互，优先级最高的事项是响应用户。


  <img loading="lazy" class="alignnone wp-image-2896 shadow" src="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfab60b4c100.png" data-src="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfab60b4c100.png?x-oss-process=image/format,webp" alt="" width="299" height="250" srcset="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfab60b4c100.png?x-oss-process=image/format,webp 944w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfab60b4c100.png?x-oss-process=image/quality,q_50/resize,m_fill,w_300,h_251/format,webp 300w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfab60b4c100.png?x-oss-process=image/quality,q_50/resize,m_fill,w_768,h_643/format,webp 768w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfab60b4c100.png?x-oss-process=image/quality,q_50/resize,m_fill,w_717,h_600/format,webp 717w" sizes="(max-width: 299px) 100vw, 299px" />

要实现小于 100 毫秒的响应，应用必须在每 50 毫秒内将控制权返回给主线程，这样应用就可以执行其像素管道、对用户输入作出反应，等等。以 50 毫秒块工作既可以完成任务，又能确保及时的响应。

### 加载：在 1000 毫秒以内呈现内容 {#1000}

在 1 秒钟内加载您的网站。否则，用户的注意力会分散，他们处理任务的感觉会中断。侧重于[优化关键渲染路径][10]以取消阻止渲染。 实际操作中，[我们](https://www.w3cdoc.com)无需在 1 秒内加载所有内容以产生完整加载的感觉，而是启用渐进式渲染和在后台执行一些工作，默认只加载和渲染首屏内容，将非首屏、非必需的加载推迟到空闲时间段处理。

### 关键 RAIL 指标汇总 {#rail}

要根据 RAIL 指标评估您的网站，请使用 Chrome DevTools [Timeline 工具][11]记录用户操作。然后根据这些关键 RAIL 指标检查 Timeline 中的记录时间。

<div class="devsite-table-wrapper">
  <table>
    <tr>
      <th>
        RAIL 步骤
      </th>

      <th>
        关键指标
      </th>
      
      <th>
        用户操作
      </th>
    </tr>
    
    <tr>
      <td data-th="RAIL Step">
       响应
      </td>
      
      <td data-th="Key Metric">
        输入延迟时间（从点按到绘制）小于 100 毫秒。
      </td>
      
      <td data-th="User Test">
        用户点按按钮（例如打开导航）。
      </td>
    </tr>
    
    <tr>
      <td data-th="RAIL Step">
       动画
      </td>
      
      <td data-th="Key Metric">
        每个帧的工作（从 JS 到绘制）完成时间小于 16 毫秒。
      </td>
      
      <td data-th="User Test">
        用户滚动页面，拖动手指（例如，打开菜单）或看到动画。 拖动时，应用的响应与手指位置有关（例如，拉动刷新、滑动轮播）。 此指标仅适用于拖动的持续阶段，不适用于开始阶段。
      </td>
    </tr>
    
    <tr>
      <td data-th="RAIL Step">
       空闲
      </td>
      
      <td data-th="Key Metric">
        主线程 JS 工作分成不大于 50 毫秒的块。
      </td>
      
      <td data-th="User Test">
        用户没有与页面交互，但主线程应足够用于处理下一个用户输入。
      </td>
    </tr>
    
    <tr>
      <td data-th="RAIL Step">
       加载
      </td>
      
      <td data-th="Key Metric">
        页面可以在 1000 毫秒内就绪。
      </td>
      
      <td data-th="User Test">
        用户加载页面并看到关键路径内容。
      </td>
    </tr>
  </table>
</div>

这是Google工程师提出来的RAIL优化模型，在实际[前端](https://www.w3cdoc.com)业务监控中，[我们](https://www.w3cdoc.com)可以拆分成更多的数据指标进行统计分析。

## 性能和体验数据指标

数据驱动业务开发，[我们](https://www.w3cdoc.com)的目标是高性能和极致用户体验，那么[我们](https://www.w3cdoc.com)首先需要制定符合[我们](https://www.w3cdoc.com)目标的性能数据指标和体验数据指标。 在制定数据指标之前，[我们](https://www.w3cdoc.com)分析下页面加载过程，[我们](https://www.w3cdoc.com)分为这四个部分：

| 用户体验            | 描述                      |
| --------------- | ----------------------- |
| 它在发生吗？happening | 网页浏览顺利开始了吗？服务端有响应吗？     |
| 它是否有用？useful    | 用户是否能看到足够的内容？           |
| 它是否可用？usable    | 用户是否可以和页面交互，还是页面仍在忙于加载？ |
| 它是否令人愉快的？idle   | 交互是否流程和自然，没有卡段或闪烁？      |

<img loading="lazy" class="alignnone wp-image-2871 shadow" src="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7f718a373.png" data-src="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7f718a373.png?x-oss-process=image/format,webp" alt="" width="718" height="399" srcset="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7f718a373.png?x-oss-process=image/format,webp 1758w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7f718a373.png?x-oss-process=image/quality,q_50/resize,m_fill,w_300,h_167/format,webp 300w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7f718a373.png?x-oss-process=image/quality,q_50/resize,m_fill,w_768,h_426/format,webp 768w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa7f718a373.png?x-oss-process=image/quality,q_50/resize,m_fill,w_800,h_444/format,webp 800w" sizes="(max-width: 718px) 100vw, 718px" />

**性能指标**：加载呈现又快又稳。加载到展现的性能指标和稳定性指标。

**体验指标**：操作反应灵敏。点击，滑动等交互响应及时，操作流畅，动画运行流畅。

<div>
  <div>
    加载性能指标：
  </div>
  <ul>
    
      秒开率：页面首屏加载时间小于1s的比例，也就是页面加载到onload事件触发时所消耗的时间。
    
    
      <a href="https://w3c.github.io/paint-timing/">FP（first paint） 和 FCP（first content paint）</a> 分别是指页面首次绘制和首次内容绘制。FP（首次绘制）包括了任何用户自定义的背景绘制，它是首先将像素绘制到屏幕的时刻。FCP（首次内容绘制）是[浏览器](https://www.w3cdoc.com)将第一个 DOM 渲染到屏幕的时间。该指标报告了[浏览器](https://www.w3cdoc.com)首次呈现任何文本、图像、画布或者 SVG 的时间。这两个指标其实指示了[我们](https://www.w3cdoc.com)通常所说的白屏时间。
    
    
      FMP(first meaningful paint)首次有意义绘制, 是页面可用性的度量标准。因为很难有一个通用标准来指示所有的页面当前时刻的渲染达是否到了有用的程度，所以当前并没有制定标准。对于开发者，[我们](https://www.w3cdoc.com)可以根据自己的页面来确定那一部分是最重要的，然后度量这部分渲染出的时间作为FMP。
    
    
      TTFB(time to first byte, 首字节时间)，是指从[浏览器](https://www.w3cdoc.com)发起第一个请求到数据返回第一个字节所消耗的时间，这个时间包含了网络时间，后端处理时间等等，可以作为一个链路数据综合参考指标。
    
  
 稳定性指标
  
  <div>
    <ul>
      
        资源错误：静态资源加载错误，常见的就是404，资源地址不正确或者远程服务有问题。
      
      
        JS报错：页面运行时抛出来的异常信息。比如变量未定义，函数报错等等。
      
      
        Crash：页面白屏不展示内容，很可能是页面某个模块报错导致整个页面不展示。
      
      
        内存堆栈：监控页面内存和堆栈使用情况，常见如页面内存泄露等原因会直接导致APP闪退。
      
      
        接口报错：接口挂了，请求超时。或者接口返回了错误信息。或者接口返回数据错误，比如空数据，不符合预期。
      
    
  </div>
</div>

<div>
  <div>
    操作体验指标：
  </div>
  <ul>
    
      响应延迟：用户点击后页面没有响应或者响应时间超过100ms，用户感觉这次点击操作是延迟的（可称为无效点击）。通过<a href="https://www.f2e123.com/pwa/3301.html">EventTiming API</a>[我们](https://www.w3cdoc.com)可以统计用户交互操作后的[浏览器](https://www.w3cdoc.com)响应时间。
    
    
      卡顿：统计[浏览器](https://www.w3cdoc.com)中执行时间超过 50 ms 的任务，都是 long task（<a href="https://w3c.github.io/longtasks/" rel="nofollow">Long tasks API</a> ），可能会造成页面卡顿。
    
    
      滚动流畅性：滚动过程是否流畅，监测用户开始操作到页面开始滚动的时间差，按照前面的标准，小于100ms才会体验流畅。
    
    
      动画流畅性：监测动画开始到动画结束，计算帧率FPS。按照前面的标准，每帧计算时间小于10ms才会体验流畅。
    
    
      TTI（<a href="https://docs.google.com/document/d/1GGiI9-7KeY3TPqS3YT271upUVimo-XiL5mwWorDUD4c/preview#">time to interactive</a>, 可交互时间)：指页面已渲染出内容，同时可以响应用户的输入的时间。
    
    
      <a href="https://developers.google.com/web/updates/2018/05/first-input-delay">FID（First Input Delay）</a>，首次输入延迟，用户首次和页面交互到页面响应交互的时间。一般都是因为主线程阻塞，会导致响应慢。这个指标反映用户对当前页面的第一感觉，比如html渲染出来一个输入框，用点了输入框页面却没有响应，卡了一下才能输入内容，这个卡的时间就是FID。
    
</div>

## 性能指标数据采集

介绍上面[我们](https://www.w3cdoc.com)总结的性能和体验指标如何准确有效的采集。

* [[前端](https://www.w3cdoc.com)页面性能指标数据计算方法][4]
* [[前端](https://www.w3cdoc.com)页面性能指标数据采集架构][5]

欢迎学习[前端](https://www.w3cdoc.com)知识体系课程，本系列属于：[[前端](https://www.w3cdoc.com)增长教程][12]

在线视频课程：<a href="https://study.163.com/course/courseMain.htm?share=2&shareId=400000000351011&courseId=1209400904&_trace_c_p_k2_=d5106aa1758748cea6e733c4b1f29bbe" target="_blank" rel="noopener noreferrer">网易云课堂课程</a>      <a href="https://segmentfault.com/ls/1650000019681091" target="_blank" rel="noopener noreferrer">思否课堂</a>

# 优化实战

[我们](https://www.w3cdoc.com)已经全面分析总结了评估页面性能和用户体验的各个指标参数。那么怎么来优化呢？[open signal][13]官方提供了2018年2月份统计的全世界4G网络覆盖率和通信速率的统计分布图如下，在目前移动互联网的浪潮下，[我们](https://www.w3cdoc.com)要利用好用户终端设备的每个字节的流量。


  <img loading="lazy" class="alignnone wp-image-2872 shadow" src="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa838fc0b92.png" data-src="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa838fc0b92.png?x-oss-process=image/format,webp" alt="" width="633" height="294" srcset="https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa838fc0b92.png?x-oss-process=image/format,webp 1404w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa838fc0b92.png?x-oss-process=image/quality,q_50/resize,m_fill,w_300,h_139/format,webp 300w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa838fc0b92.png?x-oss-process=image/quality,q_50/resize,m_fill,w_768,h_357/format,webp 768w, https://haomou.oss-cn-beijing.aliyuncs.com/upload/2018/11/img_5bfa838fc0b92.png?x-oss-process=image/quality,q_50/resize,m_fill,w_800,h_372/format,webp 800w" sizes="(max-width: 633px) 100vw, 633px" />

当然页面性能和体验优化并不是一蹴而就的，需要不断的研究、跟踪，发现问题，解决问题。但是[我们](https://www.w3cdoc.com)可以在一开始编写业务代码的时候就做的更好，做到极致。所以，关于优化实战[我们](https://www.w3cdoc.com)主要分为两部分：**加载渲染链路优化** 和 **编程代码优化**。

## 加载渲染链路优化

从访问url到页面呈现，整个加载和渲染链路可以做优化的思路。

加载链路：[浏览器](https://www.w3cdoc.com)导航开始->检查缓存->DNS->HTTP->解析

渲染链路：[浏览器](https://www.w3cdoc.com)内核或者webview（对于ios区分wkwebview和早期版本的uiwebview）渲染流程

具体详情参看下面这篇文章：

* [[前端](https://www.w3cdoc.com)网页加载渲染链路优化][6]

## 编程代码优化

[我们](https://www.w3cdoc.com)说的“快”，并不仅仅指[浏览器](https://www.w3cdoc.com)器加载页面快，就是常说的秒开率，一般指DomContentLoad时间。但是“快”其实包含更多的含义，除了前面说的[浏览器](https://www.w3cdoc.com)加载快，还包含[浏览器](https://www.w3cdoc.com)解析快（Javascript脚本发布时通常都会做代码压缩混淆，不仅是减少体积，也为了安全性），JS脚本编译快（[我们](https://www.w3cdoc.com)知道javascript在[浏览器](https://www.w3cdoc.com)的javascript虚拟机【managed runtime environment for JavaScript，JavaScript托管运行时环境】中运行的，所以也需要编辑JS脚本成字节码，才能运行），最后一个就是javascript执行快。

链路优化中，[我们](https://www.w3cdoc.com)已经解决了JavaScript下载加速的问题，那么剩下的优化工作主要集中在优化[浏览器](https://www.w3cdoc.com)解析、编译并执行JS脚本。影响[浏览器](https://www.w3cdoc.com)解析和执行JS脚本的因素主要是JS脚本的体积大小和代码的复杂程度。所以编程代码优化实践主要是减少代码的体积和按需降低代码复杂度，实现[浏览器](https://www.w3cdoc.com)解析快，JS脚本编译快。

* 代码体积大，加载就会耗时，而且占用cdn存储资源和http请求资源，[浏览器](https://www.w3cdoc.com)解析时暂用内存多，分析代码耗时。
* 代码复杂度高，代码解析就比较耗时。如果依赖一些复杂的类库，还要考虑库的解析和执行时间。[浏览器](https://www.w3cdoc.com)解析代码会占用更多内存，使用堆栈更深，执行耗时。

优化策略：

* 首屏渲染与PRPL
* 懒加载组件
* 滚动加载分页组件
* web worker
* task拆分
* 代码分割与打包
* 项目架构优化

具体详情参看下面这篇文章：[[前端](https://www.w3cdoc.com)极致性能体验编码框架优化][7]

<span style="color: #ff0000;">在线课程</span>：[云课堂视频课程][1]

# 参考

* <a href="https://infrequently.org/2017/10/can-you-afford-it-real-world-web-performance-budgets/" target="_blank" rel="noopener noreferrer">Can You Afford It?: Real-world Web Performance Budgets</a>
* <a href="https://www.youtube.com/watch?v=4bZvq3nodf4&list=PLNYkxOF6rcIBTs2KPy1E6tIYaWoFcG3uj&index=18&t=0s" target="_blank" rel="noopener noreferrer">Progressive Performance</a>
* <a href="https://developers.google.com/web/fundamentals/performance/optimizing-javascript/tree-shaking" target="_blank" rel="noopener noreferrer">Reducing JavaScript payloads with Tree-shaking</a>
* <a href="https://speedcurve.com/blog/your-javascript-hurts/" target="_blank" rel="noopener noreferrer">Ouch, your JavaScript hurts!</a>
* <a href="https://docs.google.com/presentation/d/169gop22hzmu-NEUiNQyoIZ_oRiMqNLFMKNJVvX42iC8/edit?usp=drivesdk" target="_blank" rel="noopener noreferrer">Fast & Resilient — Why carving out the “fast” path isn’t enough</a>
* <a href="https://developers.google.com/web/fundamentals/performance/webpack/" target="_blank" rel="noopener noreferrer">Web performance optimization with Webpack</a>
* <a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/javascript-startup-optimization/" target="_blank" rel="noopener noreferrer">JavaScript Start-up Optimization</a>
* <a href="https://paulcalvano.com/index.php/2018/07/02/impact-of-page-weight-on-load-time/" target="_blank" rel="noopener noreferrer">The Impact Of Page Weight On Load Time</a>
* <a href="https://building.calibreapp.com/beyond-the-bubble-real-world-performance-9c991dcd5342" target="_blank" rel="noopener noreferrer">Beyond The Bubble — Real-world Performance</a>
* <a href="https://developers.google.com/web/fundamentals/performance/speed-tools/" target="_blank" rel="noopener noreferrer">How To Think About Speed Tools</a>
* <a href="https://houssein.me/thinking-prpl" target="_blank" rel="noopener noreferrer">Thinking PRPL</a>
* [navigation-timing][14]
* [the-cost-of-javascript][15]
* [learning-and-using-the-user-timing-api][16]

<audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio> <audio style="display: none;" controls="controls"></audio>

 [1]: https://study.163.com/course/courseMain.htm?courseId=1006304007&share=2&shareId=400000000351011
 [2]: https://ke.sifou.com/course/1650000018003974
 [3]: https://www.f2e123.com/fed-regain/2390.html
 [4]: https://www.f2e123.com/pwa/3301.html
 [5]: https://www.f2e123.com/pwa/3423.html
 [6]: https://www.f2e123.com/pwa/3303.html
 [7]: https://www.f2e123.com/pwa/3305.html
 [8]: https://developers.google.com/web/fundamentals/performance/rail?hl=zh-cn
 [9]: https://developers.google.com/web/fundamentals/performance/rendering/?hl=zh-cn
 [10]: https://developers.google.com/web/fundamentals/performance/critical-rendering-path/?hl=zh-cn
 [11]: https://developers.google.com/web/tools/chrome-devtools/profile/evaluate-performance/timeline-tool?hl=zh-cn
 [12]: https://www.f2e123.com/fed-regain
 [13]: https://opensignal.com/reports/2018/02/global-state-of-the-mobile-network
 [14]: https://www.w3.org/TR/navigation-timing/#sec-navigation-timing-interface
 [15]: https://medium.com/@addyosmani/the-cost-of-javascript-in-2018-7d8950fbb5d4
 [16]: https://www.html5rocks.com/en/tutorials/webperformance/usertiming/
